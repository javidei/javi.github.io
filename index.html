<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Página de Javi</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <a href="https://javidei.github.io/" style="text-decoration: none;">
      <h2 class="favicon-header">
        <img src="favicon.ico" alt="Logo" class="favicon-img" /> El Diablo
      </h2>
    </a>
    <p>Descubre libros, ideas y cosas que me inspiran cada día</p>
    <form id="form-busqueda" style="margin-top: 1rem;">
      <input type="text" id="input-busqueda" class="campo-busqueda" placeholder="Buscar libros..." />
      <button type="submit" class="btn-buscar">Buscar</button>
      <button type="button" id="idPgDetalle" class="btn-detalles">Pantalla detalles</button>
    </form>
  </header>

  <!-- Controles de paginación -->
  <div style="text-align: center; margin: 1rem 0;">
    <button id="btnAnterior" class="btn btn-secondary">Anterior</button>
    <button id="btnSiguiente" class="btn btn-secondary">Siguiente</button>
  </div>

  <!-- Sección de contenido de libros -->
  <section class="galeria" id="galeria"></section>

  <footer>
    © 2025 - Javier Díaz - API googleapis
  </footer>

  <script>
    const API_KEY = 'AIzaSyB1ljgpeiX3ayIFHqpe2NqMWRvMwpOFcYg';
    let paginaActual = 0;
    const resultadosPorPagina = 40;
    let totalItems = 0;
  
    function actualizarBotones() {
      document.getElementById('btnAnterior').style.display = paginaActual > 0 ? 'inline-block' : 'none';
      const hayMasResultados = (paginaActual + 1) * resultadosPorPagina < totalItems;
      document.getElementById('btnSiguiente').style.display = hayMasResultados ? 'inline-block' : 'none';
    }
  
    function buscarLibros(query, startIndex = 0) {
      localStorage.setItem('ultimaBusqueda', query);
  
      fetch(`https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(query)}&startIndex=${startIndex}&maxResults=${resultadosPorPagina}&key=${API_KEY}`)
        .then(response => response.json())
        .then(data => {
          const galeria = document.getElementById('galeria');
          galeria.innerHTML = '';
  
          totalItems = data.totalItems || 0;
          actualizarBotones();
  
          if (!data.items || data.items.length === 0) {
            galeria.innerHTML = '<p style="text-align:center; width:100%;">No se encontraron resultados.</p>';
            return;
          }
  
          data.items.forEach(item => {
            const libro = item.volumeInfo;
            const contenedor = document.createElement('div');
            contenedor.style.display = 'flex';
            contenedor.style.flexDirection = 'column';
            contenedor.style.alignItems = 'center';
            contenedor.style.cursor = 'pointer';
            contenedor.title = 'Ir a video de youtube relacionado';
  
            const img = document.createElement('img');
            img.src = libro.imageLinks?.thumbnail || 'https://placehold.co/128x192/png?text=Sin+portada';
            img.alt = libro.title;
  
            const titulo = document.createElement('p');
            titulo.textContent = libro.title;
            titulo.style.marginTop = '0.5rem';
            titulo.style.fontWeight = 'bold';
            titulo.style.textAlign = 'center';
  
            const autor = document.createElement('p');
            autor.textContent = libro.authors ? `Autor: ${libro.authors.join(', ')}` : 'Autor desconocido';
  
            contenedor.appendChild(img);
            contenedor.appendChild(titulo);
            contenedor.appendChild(autor);
  
            img.addEventListener('click', () => {
              const youtubeSearchUrl = `https://www.youtube.com/results?search_query=${encodeURIComponent(libro.title + ' book review')}`;
              window.open(youtubeSearchUrl, '_blank');
            });
  
            galeria.appendChild(contenedor);
          });
        })
        .catch(err => {
          console.error('Error al cargar libros:', err);
        });
    }
  
    document.getElementById('form-busqueda').addEventListener('submit', e => {
      e.preventDefault();
      const query = document.getElementById('input-busqueda').value.trim();
      if (query) {
        paginaActual = 0;
        buscarLibros(query, 0);
      }
    });
  
    document.getElementById('btnAnterior').addEventListener('click', () => {
      if (paginaActual > 0) {
        paginaActual--;
        const query = localStorage.getItem('ultimaBusqueda');
        buscarLibros(query, paginaActual * resultadosPorPagina);
      }
    });
  
    document.getElementById('btnSiguiente').addEventListener('click', () => {
      paginaActual++;
      const query = localStorage.getItem('ultimaBusqueda');
      buscarLibros(query, paginaActual * resultadosPorPagina);
    });
  
    window.addEventListener('DOMContentLoaded', () => {
      const ultima = localStorage.getItem('ultimaBusqueda') || 'Una corte de rosas y espinas';
      document.getElementById('input-busqueda').value = ultima;
      paginaActual = 0;
      buscarLibros(ultima, 0);
    });
  
    document.getElementById('idPgDetalle').addEventListener('click', () => {
      window.location.href = 'detalle.html';
    });
</script>

</body>
</html>
